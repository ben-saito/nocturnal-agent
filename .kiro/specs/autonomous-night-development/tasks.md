# 実装計画

- [x] 1. プロジェクト基盤とコアインターフェースの構築

  - Python 3.9+プロジェクト構造の作成（src/、tests/、config/ディレクトリ）
  - 基本的なデータモデル（Task、QualityScore、ExecutionResult、ProjectContext）の実装
  - 設定管理システムの実装（YAML 設定ファイル対応）
  - _要件: 要件 1、要件 2、要件 4_

- [x] 2. ローカル LLM エージェントの実装

  - [x] 2.1 LM Studio CLI 連携の基本実装

    - LM Studio CLI（`lms`コマンド等）または HTTP API 経由での連携
    - ローカル LLM モデルの起動確認と基本的な推論機能
    - CLI/HTTP 経由でのプロンプト送信とレスポンス取得
    - エラーハンドリングとタイムアウト処理
    - _要件: 要件 7（コスト効率的運用）_

  - [x] 2.2 タスク分析機能の実装

    - タスク内容の解析と実行計画策定機能
    - 品質予測アルゴリズムの実装
    - プロンプト生成とコンテキスト注入機能
    - _要件: 要件 1、要件 2_

  - [x] 2.3 品質評価システムの実装
    - コード品質スコア計算機能（0.0-1.0 スケール）
    - 静的解析ツール（pylint、eslint 等）との連携
    - 品質閾値（0.85）に基づく自動判定機能
    - _要件: 要件 2（品質基準管理）_

- [x] 3. CLI コーディングエージェント連携システムの実装

  - [x] 3.1 CLI エージェント検出機能

    - ローカル PC で認証済み CLI ツールの自動検出（`claude`, `gh copilot`, `cursor`等）
    - 各 CLI ツールの認証状態確認機能（`claude --version`, `gh auth status`等）
    - 利用可能エージェントのリスト化と優先順位付け
    - _要件: 要件 3（マルチエージェント連携）_

  - [x] 3.2 CLI 実行基盤の実装

    - subprocess 経由での CLI コマンド実行機能
    - 一時ディレクトリでの作業ファイル管理
    - CLI 出力の標準化された解析機能
    - タイムアウト処理とプロセス管理
    - _要件: 要件 3_

  - [x] 3.3 Claude CLI 連携の実装

    - `claude`コマンドでのプロンプトファイル作成・実行
    - Claude CLI 出力の解析と構造化
    - エラーハンドリングとリトライ機能（最大 3 回）
    - 認証エラー時の適切な処理
    - _要件: 要件 3、要件 2_

  - [x] 3.4 将来拡張用 CLI 連携基盤
    - GitHub Copilot CLI（`gh copilot`）連携の準備
    - Cursor CLI 連携の準備
    - 汎用 CLI エージェント追加のためのプラグイン機構
    - _要件: 要件 3（将来拡張）_

- [x] 4. 統一性エンジンの実装

  - [x] 4.1 コードパターン抽出機能

    - 既存コードベースの解析
    - 命名規則、関数定義パターンの自動抽出
    - アーキテクチャ決定の識別機能
    - _要件: 要件 4、要件 5（統一性エンジン）_

  - [x] 4.2 リアルタイム統一性チェック

    - 生成コードの統一性スコア計算
    - 違反検出と分類機能
    - 自動修正提案の生成
    - _要件: 要件 5_

  - [x] 4.3 学習機能の実装
    - 成功パターンの蓄積機能
    - 違反から学習する改善機能
    - 動的ルール更新システム
    - _要件: 要件 5、要件 9（学習と改善）_

- [x] 5. Obsidian 連携システムの実装

  - [x] 5.1 Vault 構造の初期化

    - プロジェクト用ディレクトリ構造の自動作成
    - Markdown テンプレートファイルの生成
    - YAML frontmatter 形式の設定
    - _要件: 要件 4（プロジェクトコンテキスト永続化）_

  - [x] 5.2 コンテキスト管理機能

    - プロジェクト固有パターンの保存・読み込み
    - 開発履歴の記録機能
    - 成功・失敗事例の構造化保存
    - _要件: 要件 4、要件 9_

  - [x] 5.3 検索・取得機能
    - パターン検索とマッチング機能
    - クロスプロジェクト知識の共有機能
    - 知識ベースの整合性維持
    - _要件: 要件 4、要件 9_

- [ ] 6. 品質改善サイクルの実装

  - [ ] 6.1 改善サイクル制御機能

    - 品質基準未達成の自動検出
    - Git reset --hard による変更ロールバック
    - 最大 3 回の改善試行制御
    - _要件: 要件 2（品質基準管理）_

  - [ ] 6.2 失敗分析と改善機能

    - ローカル LLM による失敗原因分析
    - プロンプト改善と最適化機能
    - 改善履歴の記録と学習データ化
    - _要件: 要件 2、要件 9_

  - [ ] 6.3 朝承認キューシステム
    - 改善失敗タスクのキュー管理
    - 承認待ちタスクの分類と優先順位付け
    - レビュー効率化のためのカテゴライズ機能
    - _要件: 要件 2_

- [ ] 7. 夜間スケジューラーの実装

  - [ ] 7.1 時間制御システム

    - 22:00-06:00 の実行ウィンドウ制御
    - システム時刻監視と自動開始機能
    - 実行時間制限（単一タスク 30 分）の管理
    - _要件: 要件 1（夜間自動実行）_

  - [ ] 7.2 タスクキュー管理

    - 優先度ベースのタスク実行順序制御
    - 1 夜最大 10 変更の制限機能
    - 動的タスク選択と時間最適化
    - _要件: 要件 1、要件 8（並行実行）_

  - [ ] 7.3 継続実行とモニタリング
    - 人間の介入なしでの継続実行機能
    - リソース監視（CPU 80%、メモリ 8GB 制限）
    - 実行ログの完全記録機能
    - _要件: 要件 1、要件 6（安全性）_

- [ ] 8. 安全性とバックアップシステムの実装

  - [ ] 8.1 自動バックアップ機能

    - 夜間実行前の完全バックアップ作成
    - Git 状態の保存と復元機能
    - バックアップの整合性チェック
    - _要件: 要件 6（安全性とセキュリティ）_

  - [ ] 8.2 危険操作検出システム

    - 削除・フォーマット系コマンドの自動ブロック
    - 重要ファイル（設定ファイル等）の保護
    - 危険パターンの検出とログ記録
    - _要件: 要件 6_

  - [ ] 8.3 ロールバック機能
    - Git reset --hard による完全復元
    - 段階的ロールバック機能
    - 復旧状態の検証機能
    - _要件: 要件 6_

- [ ] 9. コスト管理システムの実装

  - [ ] 9.1 使用量追跡機能

    - 月額予算$10 に対する使用量監視
    - 日次・月次使用状況の記録
    - 予算制限接近時のアラート機能
    - _要件: 要件 7（コスト効率的運用）_

  - [ ] 9.2 無料優先戦略の実装
    - ローカル LLM 優先の実行制御
    - 無料ツール利用率 90%以上の維持機能
    - コスト最適化アルゴリズムの実装
    - _要件: 要件 7_

- [ ] 10. 並行実行機能の実装（Phase 1: 基本版）

  - [ ] 10.1 ブランチ管理システム

    - 夜間専用ブランチの自動作成
    - 品質レベル別ブランチ分離機能
    - ブランチ競合の検出と解決
    - _要件: 要件 8（並行実行機能）_

  - [ ] 10.2 品質別実行制御
    - 高品質タスク（0.85+）の即座適用
    - 中品質タスク（0.7-0.84）の並行ブランチ作成
    - 低品質タスクの実験ブランチ分離
    - _要件: 要件 8、要件 2_

- [ ] 11. テストスイートの実装

  - [ ] 11.1 単体テストの作成

    - 各コンポーネントの独立テスト
    - モック使用による外部依存の分離
    - 品質スコア計算の正確性テスト
    - _要件: 全要件の品質保証_

  - [ ] 11.2 統合テストの作成

    - Claude 連携の動作確認テスト
    - 品質改善サイクルの E2E テスト
    - Obsidian 連携の整合性テスト
    - _要件: 全要件の統合確認_

  - [ ] 11.3 安全性テストの作成
    - 危険操作ブロック機能のテスト
    - バックアップ・復旧機能の検証テスト
    - リソース制限の動作確認テスト
    - _要件: 要件 6（安全性）_

- [ ] 12. 設定とドキュメントの整備

  - [ ] 12.1 設定システムの実装

    - YAML 設定ファイルの構造定義
    - 環境変数による設定オーバーライド
    - 設定検証とデフォルト値の管理
    - _要件: 全要件の設定管理_

  - [ ] 12.2 ログシステムの実装

    - 構造化ログ（JSON Lines 形式）の実装
    - 実行レポート生成機能
    - ログローテーションと保存期間管理
    - _要件: 要件 1、要件 9_

  - [ ] 12.3 CLI インターフェースの実装
    - 夜間実行開始コマンドの実装
    - 設定管理コマンドの実装
    - ステータス確認とレポート表示機能
    - _要件: 運用効率化_
